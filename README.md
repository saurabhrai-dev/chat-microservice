# RAG Chat Microservice - Project Overview

## Implementation Summary

This is a chat microservice to store chat histories generated by a
RAG (Retrieval-Augmented Generation) based chatbot system.


### Core Functionalities
- ✅ Start and maintain chat sessions for users
- ✅ Save messages within a session (sender, content, optional context)
- ✅ Enable renaming of chat sessions
- ✅ Mark/unmark sessions as favorite
- ✅ Delete chat sessions and associated messages
- ✅ Retrieve message history of a chat session

### Technical Requirements
- ✅ **Framework**: Spring Boot 4.0.2 with JDK 21
- ✅ **Database**: PostgreSQL 16
- ✅ **Environment Config**: Managed via .env file
- ✅ **API Key Authentication**: Protected via X-API-Key header


### Additional Features 
- ✅ Health check endpoints (/api/v1/health and /actuator/health)
- ✅ Swagger/OpenAPI documentation (accessible at /swagger-ui.html)
- ✅ CORS configuration
- ✅ Pagination support for messages


## Quick Start Commands

```bash

# 1. Edit .env with your configuration (especially API_KEY!)

# 2. Start all services
docker-compose up -d

# 3. Check health
curl http://localhost:8080/api/v1/health

# 4. Access Swagger UI
open http://localhost:8080/swagger-ui.html

# 5. Access pgAdmin
open http://localhost:5050
```

## API Endpoints Overview

### Sessions
- `POST /api/v1/chat/sessions` - Create session
- `GET /api/v1/chat/sessions` - Get all sessions
- `GET /api/v1/chat/sessions/{id}` - Get session by ID
- `PATCH /api/v1/chat/sessions/{id}` - Update session
- `DELETE /api/v1/chat/sessions/{id}` - Delete session
- `GET /api/v1/chat/sessions/favorites` - Get favorites

### Messages
- `POST /api/v1/chat/sessions/{id}/messages` - Add message
- `GET /api/v1/chat/sessions/{id}/messages` - Get all messages
- `GET /api/v1/chat/sessions/{id}/messages/paginated` - Get paginated

### Health
- `GET /api/v1/health` - Custom health check
- `GET /actuator/health` - Spring actuator health

## Key Features Explained

### 1. API Key Authentication
- All endpoints (except health checks) require `X-API-Key` header
- Configured via environment variable
- Fails with 401 if missing or invalid

### 2. Rate Limiting
- 100 requests per minute per API key
- Uses Bucket4j for efficient token bucket algorithm
- Returns 429 when limit exceeded

### 3. Database Schema
- **chat_sessions**: Stores session metadata
    - Cascade deletes all messages when session deleted
    - Supports soft features (favorite flag)
    - Timestamps for created/updated

- **chat_messages**: Stores conversation messages
    - Links to session via foreign key
    - Supports optional RAG context field
    - Ordered by creation time

### 4. Error Handling
- Validation errors return field-level details
- Resource not found returns 404
- Unauthorized returns 401
- Rate limit exceeded returns 429
- Generic errors return 500 with safe message

### 5. Pagination
- Default page size: 20 messages
- Supports custom page and size parameters
- Returns Spring Data Page object with metadata

